# Japan Domestic Flight Map（現状要件）

最終更新: 2026-02-03

## 1. 目的 / 概要

- 日本国内線の路線を地図上に可視化し、条件で絞り込みできる静的Webアプリ。
- 公開: GitHub Pages 想定（サーバー処理なし）。
- 地図: Leaflet + OpenStreetMap タイル。

## 2. 画面 / 操作要件

### 2.1 検索UI

- 上部に検索バーを表示する。
- 条件:
  - 空港（1つ選択。選択した空港が `origin` または `destination` に含まれる路線を対象）
  - 航空会社（1つ選択。`route.airlines` に含まれる路線を対象）
- 「検索」押下で絞り込み結果を地図へ反映する。
- 「リセット」押下で条件をクリアし、全路線を表示する。
- 検索結果の件数（該当路線数）を表示する。

### 2.2 空港の選びやすさ（地域→空港）

- 空港選択は `<select>` ではなく、ボタンから開くパネルで行う。
- パネルは2カラム:
  - 左: 地域一覧
  - 右: 地域内の空港一覧
- 地域一覧 / 空港一覧ともにスクロール可能（マウスホイール・スマホのスクロールで最後まで到達できること）。
- 主要空港は常に地域一覧の最上段「主要な空港」にも表示する。

## 3. 表示要件（地図）

### 3.1 路線（ライン）

- 路線は空港間の直線で表示する。
- クリック/タップしやすいように、見た目用の線と当たり判定用の透明な太線を別レイヤで重ねる。
- 路線をクリックするとポップアップを表示する。
  - 表記は `出発地 ⇄ 到着地`（矢印は `⇄`）
  - 空港名は IATA ではなく日本語（`airports.json` の `city` 由来）
  - 航空会社も IATA ではなく会社名（`airlines.json` の `name` 由来）
- ホバーで当該路線のみ強調表示（他は薄く）する。

### 3.2 空港マーカー

- マーカーは白（塗り）で表示し、外枠は濃色。
- マーカーは最前面に表示される（路線より上）。
- マーカーをホバーすると、その空港に接続する路線を強調表示する。

## 4. データ要件（JSON）

### 4.1 `data/airports.json`

1要素 = 1空港（または飛行場）。主要フィールド:

- `iata`:
  - IATAコード（例: `HND`）
  - **空港選択や路線キーに使う前提のため、通常は null ではないこと**
  - `iata: null` の要素は「名称表示用」とし、空港選択リストには出さない
- `city`: 表示名（日本語）
- `lat` / `lng`: 緯度経度
- `region`: 地域分類（下記のいずれか）
  - `北海道 / 東北 / 関東・信越 / 東海・北陸 / 関西 / 中国 / 四国 / 九州 / 沖縄`
- `major`: 主要空港フラグ（boolean）

#### 主要空港の表示順

主要空港は次の順で表示する:

1. 羽田（`HND`）
2. 成田（`NRT`）
3. 伊丹（`ITM`）
4. 関西（`KIX`）
5. 新千歳（`CTS`）
6. 名古屋（中部, `NGO`）
7. 福岡（`FUK`）
8. 那覇（`OKA`）

#### 地域内の並び

- `major: true` を上にする
- 離島扱いの空港は下に送る
- その後は日本語で名称ソート

### 4.2 `data/airlines.json`

1要素 = 1航空会社。主要フィールド:

- `iata`: IATAコード（例: `JL`, `NH`）
- `name`: 会社名（日本語/英語どちらでもよいが、画面表示はこれを使う）
- `type`: 分類（FSC/LCC/Regional/Hybrid など。UI上は現状未使用）
- `hidden: true` または `iata: null` の航空会社は選択肢に出さない（内部用/将来用）

#### 統合方針（互換）

- `EH`（ANAウィングス）など、統合したい会社コードは `NH` 扱いに寄せる。
  - 既存データに `EH` が混在しても表示・検索上は `NH` として扱う。

### 4.3 `data/routes.json`

1要素 = 1路線:

```json
{ "origin": "HND", "destination": "FUK", "airlines": ["JL", "NH"] }
```

要件:

- `origin` / `destination` は `airports.json` の `iata` と一致すること。
- `airlines` は `airlines.json` の `iata` を配列で保持する（複数社あり）。
- **可読性のため 1ルート1行で記述**し、出発地（`origin`）→到着地（`destination`）で並べる。
- 「運休中」など、現行でない路線は含めない。

## 5. 路線の統合ルール（往復・重複対策）

データ投入・表示は以下を前提とする:

- `A→B` と `B→A` は**同一路線として1本に統合**する（往復は1本）。
- 統合時は **`airlines` を union（足し合わせ）**し、どの会社も落とさない。
- 既存情報は消さずに「追加・統合」する。

## 6. 実装上の前提（現在の挙動）

- ロード時に `routes.json` を正規化してからアプリ内 `routes` として使う:
  - 往復重複を統合
  - `airlines` を重複排除してソート
  - `origin/destination` の向きを固定（主要空港を含む場合は主要空港側を優先して `origin` 側に寄せる）
- ルートのポップアップは「日本語空港名」と「航空会社名」を表示する。

